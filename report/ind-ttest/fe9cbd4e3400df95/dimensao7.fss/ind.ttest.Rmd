---
title: "Independent sample t-test for `dimensao7.fss` ~ `cenário`"
author: Geiser C. Challco <geiser@usp.br>
comment: This file is automatically generate by Shiny-Statistic app (https://statistic.geiser.tech/)
         Author - Geiser C. Challco <geiser@usp.br>
         
         Shiny-Statistic is distributed in the hope that it will be useful,
         but WITHOUT ANY WARRANTY; without even the implied warranty of
         MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
         GNU General Public License for more details.
         
         You should have received a copy of the GNU General Public License.
         If not, see <https://www.gnu.org/licenses/>.
output:
  github_document: default
  word_document: default
  html_document: default
  pdf_document:
    keep_tex: true
fontsize: 10pt
---

```{r setup, include=FALSE}
if (!'remotes' %in% rownames(installed.packages())) install.packages('remotes')
if (!"rshinystatistics" %in% rownames(installed.packages())) {
  remotes::install_github("geiser/rshinystatistics")
} else if (packageVersion("rshinystatistics") < "0.0.0.9028") {
  remotes::install_github("geiser/rshinystatistics")
}

wants <- c('ggplot2','ggpubr','rshinystatistics','car','stats','rstatix','utils','dplyr','knitr')
has <- wants %in% rownames(installed.packages())
if (any(!has)) install.packages(wants[!has])

library(knitr)
opts_chunk$set(echo = TRUE)

library(utils)
library(ggpubr)
library(ggplot2)
library(rstatix)
library(rshinystatistics)

defaultW <- getOption("warn")
options(warn = -1)

dat <- read.csv("data.csv")
rownames(dat) <- dat[["nome"]]
```

## Initial Data  and R-Script

Initial data: [data.csv](data.csv)
R-script file: [ind.ttest.R](ind.ttest.R)

## Check Assumptions

### Identifying outliers

Outliers tend to increase type-I error probability, and they decrease the calculated statistic in parametric tests resulting in a lower chance of reject the null hypothesis.

* Identified outliers using rstatix

```{r}
identify_outliers(dplyr::group_by(dat, `cenário`), `dimensao7.fss`)
```

* Identified outliers through Boxplots

```{r}
car::Boxplot(`dimensao7.fss` ~ `cenário`, data = dat, id = list(n = Inf))
```


### Removing outliers from the data

```{r}
outliers <- c("")
rdat <- dat[!dat[["nome"]] %in% outliers,]
```

### Normality assumption

**Observation**:

As sample sizes increase, parametric tests remain valid even with the violation of normality <sup>[[1](#references)]</sup>.
According to the central limit theorem, the sampling distribution tends to be normal if the sample is large, more than (`n > 30`) observations. Therefore, we performed parametric tests with large samples as described as follows: 

- In cases with the sample size greater than 30 (`n > 30`), we adopted a significance level of `p < 0.01` instead a significance level of `p < 0.05`.

- In cases with the sample size greater than 100 (`n > 100`), we adopted a significance level of `p < 0.001`

- For samples with `n > 50` observation, we adopted D'Agostino-Pearson test that offers better accuracy for larger samples <sup>[[2](#references)]</sup>.

- For samples' size between `n > 100` and `n <= 200`, we ignored both tests (Shapiro and D'Agostino-Persons), and our decision of normality were based only in the interpretation of QQ-plots and histograms because these tests tend to be too sensitive with values greater than 200 <sup>[[3](#references)]</sup>.

- For samples with `n > 200` observation, we ignore the normality assumption based on the central theorem limit.

#### Applying transformation for skewness data when normality is not achieved



#### Removing data that affect normality (extreme values)

```{r}
non.normal <- c("")
sdat <- rdat[!rdat[["nome"]] %in% non.normal,]
rownames(sdat) <- sdat[["nome"]]
```

#### Checking normality assumption in the groups

```r
normality_test_per_group(sdat, "dimensao7.fss", "cenário")
```

```{r echo=FALSE}
kdf <- normality_test_per_group(sdat, "dimensao7.fss", "cenário")
kdf$p <- round(kdf$p, 3)
kdf$p[which(kdf$p < 0.001)] <- '<0.001'
kable(kdf, digits = 3)
```


* The QQ plot used to evaluate normality assumption

```{r}
car::qqPlot(`dimensao7.fss` ~ `cenário`, data = sdat, ylab = "sample")
```

### Homogeneity of variance assumption

```r
homogeneity_test(sdat, "dimensao7.fss", "cenário")
```

```{r echo=FALSE}
kdf <- homogeneity_test(sdat, "dimensao7.fss", "cenário")
kdf$p <- round(kdf$p, 3)
kdf$p[which(kdf$p < 0.001)] <- '<0.001'
kable(kdf, digits = 3)
```

Homogeneity may be ignored using Welch's method (default method in rshiny-statistics).


## Computation t-test and effect size

```r
res <- ind_ttest(sdat, "dimensao7.fss", "cenário", "two.sided", FALSE, FALSE, as.list=T)
(res$t.test)
```

```{r echo=FALSE}
res <- ind_ttest(sdat, "dimensao7.fss", "cenário", "two.sided", FALSE, FALSE, as.list=T)
kdf <- res$t.test[,c(".y.", "group1", "group2", "n1", "n2","statistic", "df", "p", "estimate",
                    "conf.low", "conf.high", "effsize", "magnitude", "p.signif")]
kdf$p <- round(kdf$p, 3)
kdf$p[which(kdf$p < 0.001)] <- '<0.001'
kable(kdf, digits = 3)
```

## Descriptive Statistic and T-Test Plots 

```r
descriptive_statistics(sdat, "dimensao7.fss", "cenário", "common")
```

```{r echo=FALSE}
kdf <- descriptive_statistics(sdat, "dimensao7.fss", "cenário", "common")
cnames <- c("n","mean","median","min","max","q1","q3","sd","se","ci","iqr","mad")
cnames <- unique(c("variable", colnames(kdf)[!colnames(kdf) %in% cnames], "n", "mean", "median","sd","se","ci"))
kdf <- kdf[,cnames]
kable(kdf, digits = 3)
```


```{r, fig.width=8, fig.height=6 }
ggPlotTTest(sdat, "cenário", "dimensao7.fss", res$tt[["dimensao7.fss"]], c("jitter"), font.label.size=10)
```

## References

<sup>[1]</sup>: Ghasemi, A., & Zahediasl, S. (2012). Normality tests for statistical analysis: a guide for non-statisticians. International journal of endocrinology and metabolism, 10(2), 486.

<sup>[1]</sup>: Miot, H. A. (2017). Assessing normality of data in clinical and experimental trials. J Vasc Bras, 16(2), 88-91.