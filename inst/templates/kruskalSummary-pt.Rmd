---
title: "Resumo dos testes Kruskal-Wallis para {{ paste0(paste0('`', dvs, '`'), collapse = ',') }}"
author: {{ author }} <{{ email }}>
comment: This file is automatically generate by Shiny-Statistic app (https://statistic.geiser.tech/)
         Author - Geiser C. Challco <geiser@usp.br>
         
         Shiny-Statistic is distributed in the hope that it will be useful,
         but WITHOUT ANY WARRANTY; without even the implied warranty of
         MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
         GNU General Public License for more details.
         
         You should have received a copy of the GNU General Public License.
         If not, see <https://www.gnu.org/licenses/>.
output:
  github_document: default
  word_document: default
  html_document: default
  pdf_document:
    keep_tex: true
fontsize: 10pt
---

```{r setup, include=FALSE}
if (!'remotes' %in% rownames(installed.packages())) install.packages('remotes')
if (!"rshinystatistics" %in% rownames(installed.packages())) {
  remotes::install_github("geiser/rshinystatistics")
} else if (packageVersion("rshinystatistics") < "{{ rshinystatistics.version }}") {
  remotes::install_github("geiser/rshinystatistics")
}

wants <- c('ggplot2','ggpubr','rshinystatistics','utils', 'knitr')
has <- wants %in% rownames(installed.packages())
if (any(!has)) install.packages(wants[!has])

library(knitr)
opts_chunk$set(echo = TRUE)

library(utils)
library(ggpubr)
library(ggplot2)
library(rshinystatistics)

defaultW <- getOption("warn")
options(warn = -1)
```

## Dados iniciais e R-Script

* R-script file: [kruskal.R](kruskal.R)
{{ paste0(paste0('* Data for ', dvs, ' [data-',dvs,'.csv](data-',dvs,'.csv)'), collapse = '\n') }}

### Definição do identificador, variável independente e variáveis dependentes

```{r}
wid <- "{{ wid }}"
between <- c({{ paste0(paste0('"', between, '"'), collapse = ',') }})
dvs <- c({{ paste0(paste0('"', dvs, '"'), collapse = ',') }})
ldvs <- as.list(dvs); names(ldvs) <- dvs
dat <- lapply(ldvs, FUN = function(dv) {
  data <- read.csv(paste0("data-",dv,".csv"))
  rownames(data) <- data[["{{ wid }}"]]
  return(data)
})
```

## Tirando outliers dos dados (opcional)

```{r}
outliers <- {{ code.outliers }}
sdat <- remove_from_datatable(dat, outliers, wid, "var")
```

## Computação do Kruskal-Wallis and Comparações emparelhadas

### Teste de Kruskal-Wallis

```r
kruskal <- get.kruskal.test(sdat, dvs, between, dv.var = "var")
(get.kruskal.table(kruskal))
```

```{r echo=FALSE}
kruskal <- get.kruskal.test(sdat, dvs, between, dv.var = "var")
cnames <- c("var","n","df","statistic","effsize","magnitude","p", "p.signif")
kdf <- get.kruskal.table(kruskal)[,cnames]
kdf$p <- round(kdf$p, 3)
kdf$p[which(kdf$p < 0.001)] <- '<0.001'
kable(kdf, digits = 3)
```

### Resultado do teste de comparações emparelhadas com diferenças significativas

```r
pwc <- get.kruskal.pwc(sdat, dvs, between, pwc.method = "{{ pwc.method }}", p.adjust.method = "{{ p.adjust.method }}", dv.var = "var")
(get.kruskal.pwc.table(pwc, only.sig = T))
```

```{r echo=FALSE}
pwc <- get.kruskal.pwc(sdat, dvs, between, pwc.method = "{{ pwc.method }}", p.adjust.method = "{{ p.adjust.method }}", dv.var = "var")
cnames <- c("var","group1","group2","n1","n2","estimate","statistic","p","p.adj","p.adj.signif")
kdf <- get.kruskal.pwc.table(pwc, only.sig = T)[,cnames]
kdf$p <- round(kdf$p, 3)
kdf$p[which(kdf$p < 0.001)] <- '<0.001'
kdf$p.adj <- round(kdf$p.adj, 3)
kdf$p.adj[which(kdf$p.adj < 0.001)] <- '<0.001'
kable(kdf, digits = 3)
```

## Estatística Descritiva e Gráficos

```r
descriptive_statistics(sdat, dvs, between, "common", "var")
```

```{r echo=FALSE}
kdf <- descriptive_statistics(sdat, dvs, between, "common", "var")
cnames <- c("variable",between,"n","median","mean","min","max","iqr","sd")
kdf <- kdf[,cnames]
kable(kdf, digits = 3)
```

{{ kruskal.plots  }}


## Relatório textual

{{ kruskal.text }}

{{ kruskal.pwc.text }}

